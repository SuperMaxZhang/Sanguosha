# 三国杀实现差异分析与迭代计划

## 当前实现与标准规则差异

- 已实现：回合流程（摸/出/弃）、多人数与身份、基础牌与部分锦囊、AI基础、UI动画、死亡与胜利判定（部分）
- 缺失：响应机制（出杀需闪、无懈可击等）、距离与攻击范围、装备牌系统（武器/防具/坐骑）、判定与延时锦囊、AOE锦囊（万箭/南蛮/桃园/五谷）、多目标选择、准备与判定阶段的技能触发、濒死求桃（他人响应）、完整死亡奖惩、武将技能大部分实现、连环与火攻机制

## 实现优先级（阶段化）

- 第1阶段（核心交互）
  1. 响应机制框架（已完成：引擎ResponseSystem；进行中：UI响应）
  2. 准备/判定/摸牌阶段（已完成：准备/判定阶段骨架与事件；摸牌迁移至start_turn）
  3. 距离与攻击范围（待做）
  4. 装备牌基础（武器/马）（待做）

- 第2阶段（战术丰富）
  5. AOE锦囊：万箭齐发、南蛮入侵、桃园结义、五谷丰登
  6. 判定机制与延时锦囊：乐不思蜀、闪电、兵粮寸断
  7. 濒死求桃（全员可响应）

- 第3阶段（技能与AI）
  8. 武将技能完善（龙胆、观星、青囊、无双、仁德、武圣、制衡等）
  9. AI身份与策略优化（队友识别、技能/装备/距离考虑）
  10. 死亡奖惩与完整胜利判定（击反+3、主公误杀惩罚、内奸胜）

## 近期迭代路线

- 已做：
  - 引擎新增ResponseSystem（AI自动响应；玩家触发UI事件）
  - Slash改为通过响应系统请求闪；玩家响应后再决定是否结算伤害
  - 回合新增start_turn（准备/判定/摸牌/出牌）；初始回合使用start_turn

- 正在做：
  - UI添加响应对话框与事件处理（response_request）
  - finish_turn改用start_turn，避免重复代码

- 待做：
  - 无响应时由响应系统统一结算伤害的逻辑（已规划）
  - 装备与距离框架搭建
